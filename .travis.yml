os: osx
osx_image: xcode11

addons:
  homebrew:
    update: true
    packages:
      - bash
      - coreutils
      - findutils
      - jq

stages:
  - xcode-headers-setup
  - build
  - deploy
  - upload
  - push

script: |
    [[ ! -f "/Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg" ] || sudo installer -pkg /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg -target /
    ./buttler info
    ./buttler build-tap
    ./buttler upload
    ./buttler push
